<div class="simple-chat-layout">
  <!-- Error Fallback Overlay -->
  <div class="error-overlay" *ngIf="errorState && errorState.hasError">
    <app-error-fallback
      [errorState]="errorState"
      [config]="fallbackConfig"
      (retry)="onErrorRetry()"
      (contactSupport)="onErrorContactSupport()"
      (dismiss)="onErrorDismiss()">
    </app-error-fallback>
  </div>

  <!-- Header -->
  <div class="chat-header">
    <div class="document-info">
      <div class="document-icon">
        <!-- Show loading spinner when uploading -->
        <div *ngIf="isUploadingToApi" class="upload-spinner">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="animate-spin">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
              <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416;0 31.416" repeatCount="indefinite"/>
              <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416;-31.416" repeatCount="indefinite"/>
            </circle>
          </svg>
        </div>
        <!-- Show document icon when not uploading -->
        <svg *ngIf="!isUploadingToApi" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
          <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="14,2 14,8 20,8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="document-details">
        <h1
          [matTooltip]="getFullDocumentTitle()"
          [matTooltipDisabled]="getDocumentTitle().length <= 25"
          matTooltipPosition="below"
          class="truncated-title">
          {{ getTruncatedDocumentTitle() }}
        </h1>
        <p *ngIf="getDocumentSubtitle()">{{ getDocumentSubtitle() }}</p>
      </div>
    </div>

    <!-- Upload PDF Button (shown only after backend processing completes) -->
    <div class="header-actions" *ngIf="hasUploaded()">
      <button mat-raised-button
              class="upload-pdf-btn"
              routerLink="/upload"
              matTooltip="Upload a different PDF">
        <mat-icon class="mr-2">upload_file</mat-icon>
        <span class="btn-text">Upload PDF</span>
      </button>
    </div>
  </div>

  <!-- Mobile Controls -->
  <div class="mobile-controls">
    <!-- Upload PDF Button (always visible on mobile) -->
    <button
      class="control-btn upload-btn"
      routerLink="/upload"
      title="Upload PDF">
      <mat-icon>upload_file</mat-icon>
    </button>

    <!-- PDF Toggle Button (only when PDF is loaded) -->
    <button
      class="control-btn pdf-toggle-btn"
      (click)="toggleMobilePdf()"
      [class.active]="showMobilePdf"
      title="Toggle PDF View"
      *ngIf="pdfSrc">
      <mat-icon>picture_as_pdf</mat-icon>
    </button>

    <!-- Reset Chat Button (only when PDF is loaded) -->
    <button
      class="control-btn reset-btn"
      (click)="resetChat()"
      title="Reset Chat"
      *ngIf="pdfSrc">
      <mat-icon>refresh</mat-icon>
    </button>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Chat Section (Left) -->
    <div class="chat-section">
      <!-- Suggestions -->
      <div class="suggestions" *ngIf="shouldShowSuggestions()">
        <!-- Intro message for PDF documents -->
        <div class="suggestions-intro" *ngIf="hasPdf() && !hasUserSentMessage">
          <p>You can now ask questions about your document. For example:</p>
        </div>

        <div class="suggestion-item" *ngFor="let suggestion of getSuggestions()">
          <span class="bullet">â€¢</span>
          <span>"{{ suggestion }}"</span>
        </div>
      </div>

      <!-- Chat Container -->
      <div class="chat-container">
        <app-chatbot
          [pdfSrc]="pdfSrc"
          (userMessageSent)="onUserMessageSent()"
          (citationClicked)="onCitationClick($event)">
        </app-chatbot>
      </div>
    </div>

    <!-- PDF Section (Right) -->
    <div class="pdf-section">
      <app-pdf-viewer [pdfSrc]="pdfSrc"></app-pdf-viewer>
    </div>
  </div>

  <!-- Mobile PDF Overlay -->
  <div class="mobile-pdf-overlay" [class.show]="showMobilePdf" *ngIf="pdfSrc">
    <div class="mobile-pdf-header">
      <h3
        [matTooltip]="getDocumentFilename()"
        [matTooltipDisabled]="getDocumentFilename().length <= 25"
        matTooltipPosition="below"
        class="truncated-title">
        {{ getTruncatedDocumentFilename() }}
      </h3>
      <button class="close-btn" (click)="toggleMobilePdf()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <div class="mobile-pdf-content">
      <app-pdf-viewer [pdfSrc]="pdfSrc"></app-pdf-viewer>
    </div>
  </div>
</div>
